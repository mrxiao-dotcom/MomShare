# Windows 防火墙开放端口 5000 配置说明

## 方法一：图形界面操作（推荐）

### 步骤 1：打开 Windows 防火墙高级设置
1. 按 `Win + R` 键，打开运行对话框
2. 输入 `wf.msc`，按回车
3. 或者通过：**控制面板** → **系统和安全** → **Windows Defender 防火墙** → **高级设置**

### 步骤 2：创建入站规则
1. 在左侧面板中，点击 **"入站规则"**
2. 在右侧面板中，点击 **"新建规则..."**

### 步骤 3：配置规则向导

#### 步骤 1：规则类型
- 选择 **"端口"**
- 点击 **"下一步"**

#### 步骤 2：协议和端口
- 选择 **"TCP"**
- 选择 **"特定本地端口"**
- 在文本框中输入：`5000`
- 点击 **"下一步"**

#### 步骤 3：操作
- 选择 **"允许连接"**
- 点击 **"下一步"**

#### 步骤 4：配置文件
- 勾选所有三个选项：
  - ✅ **域**
  - ✅ **专用**
  - ✅ **公用**
- 点击 **"下一步"**

#### 步骤 5：名称
- 名称：`MomShares Web Server (Port 5000)`
- 描述（可选）：`允许访问 MomShares 份额管理系统的 Web 服务器`
- 点击 **"完成"**

### 验证规则
1. 在 **"入站规则"** 列表中，找到 **"MomShares Web Server (Port 5000)"**
2. 确认规则状态为 **"已启用"**（绿色对勾）

---

## 方法二：PowerShell 命令行（快速）

### 步骤 1：以管理员身份运行 PowerShell
1. 按 `Win + X` 键
2. 选择 **"Windows PowerShell (管理员)"** 或 **"终端 (管理员)"**
3. 如果出现用户账户控制提示，点击 **"是"**

### 步骤 2：执行命令
复制并执行以下命令：

```powershell
New-NetFirewallRule -DisplayName "MomShares Web Server (Port 5000)" -Direction Inbound -LocalPort 5000 -Protocol TCP -Action Allow -Profile Domain,Private,Public
```

### 步骤 3：验证规则
执行以下命令查看规则：

```powershell
Get-NetFirewallRule -DisplayName "*5000*" | Format-Table DisplayName, Enabled, Direction, Action -AutoSize
```

---

## 方法三：使用提供的脚本

1. 在项目根目录找到 `open_port_5000.ps1` 文件
2. 右键点击该文件，选择 **"使用 PowerShell 运行"**
3. 如果提示需要管理员权限，请：
   - 右键点击文件
   - 选择 **"使用 PowerShell 运行"**
   - 在 PowerShell 窗口中输入：`Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`
   - 然后再次运行脚本

或者以管理员身份运行 PowerShell，然后执行：

```powershell
cd D:\CSharpProjects\MomShares
.\open_port_5000.ps1
```

---

## 验证端口是否开放

### 方法 1：使用 PowerShell 测试
```powershell
Test-NetConnection -ComputerName localhost -Port 5000
```

### 方法 2：使用 telnet（需要启用）
```cmd
telnet localhost 5000
```

### 方法 3：从其他机器访问
在浏览器中输入：`http://<服务器IP>:5000`

---

## 常见问题

### Q: 规则创建后仍然无法访问？
A: 检查以下几点：
1. 确认规则已启用（状态为绿色）
2. 确认规则应用于正确的配置文件（域/专用/公用）
3. 检查是否有其他防火墙软件（如第三方安全软件）阻止了连接
4. 确认 Web 服务器正在运行并监听 0.0.0.0:5000

### Q: 如何删除规则？
A: 在 PowerShell 中执行：
```powershell
Remove-NetFirewallRule -DisplayName "MomShares Web Server (Port 5000)"
```

### Q: 如何临时禁用规则？
A: 在 PowerShell 中执行：
```powershell
Disable-NetFirewallRule -DisplayName "MomShares Web Server (Port 5000)"
```

### Q: 如何重新启用规则？
A: 在 PowerShell 中执行：
```powershell
Enable-NetFirewallRule -DisplayName "MomShares Web Server (Port 5000)"
```

---

## 安全建议

1. **仅开放必要的端口**：只开放实际使用的端口（5000）
2. **使用强密码**：确保管理员账户和 JWT 密钥使用强密码
3. **考虑使用 HTTPS**：如果服务器暴露在公网，建议配置 SSL 证书
4. **限制访问来源**：如果可能，在防火墙中限制只允许特定 IP 地址访问
5. **定期更新**：保持系统和应用程序更新

---

## 完成后的操作

配置完成后：
1. 启动 MomShares.Server 应用程序
2. 查看日志，确认服务已启动
3. 在浏览器中访问：`http://<服务器IP>:5000`
4. 如果从其他机器访问，确保使用服务器的实际 IP 地址

